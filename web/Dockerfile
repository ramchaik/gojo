FROM node:18-alpine

WORKDIR /usr/src/app

COPY package*.json ./
RUN npm ci

COPY . .

RUN npm run build

RUN npm prune --production

ARG COOKIE_SECRET
ARG LIVEBLOCKS_SECRET_KEY
ARG DATABASE_URL
ARG BACKEND_API_BASE_URL

ENV COOKIE_SECRET=${COOKIE_SECRET}
ENV LIVEBLOCKS_SECRET_KEY=${LIVEBLOCKS_SECRET_KEY}
ENV DATABASE_URL=${DATABASE_URL}
ENV BACKEND_API_BASE_URL=${BACKEND_API_BASE_URL}

EXPOSE 3000
CMD ["npm", "start"]